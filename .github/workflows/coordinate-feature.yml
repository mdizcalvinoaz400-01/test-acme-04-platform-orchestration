name: Coordinate Feature

on:
  issues:
    types: [opened, labeled]

jobs:
  create-department-issues:
    if: contains(github.event.issue.labels.*.name, 'feature')
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Parse Feature Details
        id: parse
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const body = issue.body || '';
            core.setOutput('title', issue.title);
            core.setOutput('number', issue.number);
      
      - name: Create Department Issues
        uses: actions/github-script@v7
        env:
          PARENT_TITLE: ${{ steps.parse.outputs.title }}
          PARENT_NUMBER: ${{ steps.parse.outputs.number }}
        with:
          github-token: ${{ secrets.CROSS_REPO_TOKEN }}
          script: |
            console.log('Creating department issues...');
